<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINE 官方帳號加購訊息計算器</title>
    <style>
        :root {
            --line-green: #06C755;
            --bg-color: #f4f7f6;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            display: flex;
            justify-content: center;
            padding: 20px;
        }
        .container {
            background: white;
            width: 100%;
            max-width: 400px;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        h1 {
            color: var(--line-green);
            font-size: 22px;
            text-align: center;
            margin-bottom: 25px;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }
        input {
            width: 100%;
            padding: 12px;
            box-sizing: border-box;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 18px;
            outline: none;
            transition: border-color 0.3s;
        }
        input:focus {
            border-color: var(--line-green);
        }
        .result-box {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            border-left: 5px solid var(--line-green);
            margin-top: 10px;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 16px;
        }
        .result-value {
            font-weight: bold;
            color: #000;
        }
        .details-btn {
            display: block;
            width: 100%;
            background: none;
            border: none;
            color: #666;
            text-decoration: underline;
            margin-top: 20px;
            cursor: pointer;
            font-size: 14px;
        }
        #details {
            display: none;
            font-size: 13px;
            color: #666;
            margin-top: 10px;
            line-height: 1.6;
            background: #eee;
            padding: 10px;
            border-radius: 8px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>LINE 訊息費用試算</h1>

    <div class="input-group">
        <label>月訊息總數 (G15)</label>
        <input type="number" id="msgCount" placeholder="請輸入訊息總數">
    </div>

    <div class="input-group">
        <label>預算金額 (G17)</label>
        <input type="number" id="budget" placeholder="請輸入預算金額">
    </div>

    <div class="result-box">
        <div class="result-item">
            <span>預估總金額 (H15)</span>
            <span class="result-value" id="resAmount">$ 0</span>
        </div>
        <div class="result-item">
            <span>預估可發數量 (H17)</span>
            <span class="result-value" id="resCount">0 則</span>
        </div>
        <div class="result-item">
            <span>平均單價 (I15/I17)</span>
            <span class="result-value" id="resAvg">$ 0</span>
        </div>
    </div>

    <button class="details-btn" onclick="toggleDetails()">點擊查看計算規則與階梯費率</button>
    <div id="details">
        固定月費：$1,200 (包含 6,000 則免付費訊息)<br>
        加購階梯單價：<br>
        6,001 - 10,000：$0.200<br>
        10,001 - 30,000：$0.170<br>
        30,001 - 50,000：$0.145<br>
        50,001 - 100,000：$0.110<br>
        (以此類推，單價隨數量遞減)
    </div>
</div>

<script>
    // 根據試算表定義的階梯費率 (範例數據，會依照你試算表的邏輯運行)
    const tiers = [
        { min: 0, max: 4000, price: 0.200 },
        { min: 4000, max: 24000, price: 0.170 },
        { min: 24000, max: 44000, price: 0.145 },
        { min: 44000, max: 94000, price: 0.110 },
        { min: 94000, max: 194000, price: 0.075 },
        { min: 194000, max: 494000, price: 0.045 },
        { min: 494000, max: 994000, price: 0.025 },
        { min: 994000, max: Infinity, price: 0.011 }
    ];
    const BASE_FEE = 1200;
    const FREE_MSGS = 6000;

    const msgInput = document.getElementById('msgCount');
    const budgetInput = document.getElementById('budget');

    // 計算金額邏輯
    msgInput.addEventListener('input', () => {
        let count = parseFloat(msgInput.value) || 0;
        let extra = Math.max(0, count - FREE_MSGS);
        let extraCost = 0;

        tiers.forEach(tier => {
            if (extra > tier.min) {
                let billableInRange = Math.min(extra, tier.max) - tier.min;
                extraCost += billableInRange * tier.price;
            }
        });

        let total = count > 0 ? BASE_FEE + extraCost : 0;
        document.getElementById('resAmount').innerText = `$ ${Math.round(total).toLocaleString()}`;
        document.getElementById('resAvg').innerText = count > 0 ? `$ ${(total / count).toFixed(3)}` : '$ 0';
        
        // 同步清除另一個輸入框的顯示結果，避免混淆
        if(msgInput.value === "") document.getElementById('resAmount').innerText = "$ 0";
    });

    // 計算數量邏輯 (反推)
    budgetInput.addEventListener('input', () => {
        let budget = parseFloat(budgetInput.value) || 0;
        let available = budget - BASE_FEE;
        let extraMsgs = 0;

        if (available > 0) {
            tiers.forEach(tier => {
                let rangeMaxCost = (tier.max - tier.min) * tier.price;
                if (available > rangeMaxCost) {
                    extraMsgs += (tier.max - tier.min);
                    available -= rangeMaxCost;
                } else if (available > 0) {
                    extraMsgs += available / tier.price;
                    available = 0;
                }
            });
        }

        let totalCount = budget >= BASE_FEE ? FREE_MSGS + extraMsgs : 0;
        document.getElementById('resCount').innerText = `${Math.floor(totalCount).toLocaleString()} 則`;
        document.getElementById('resAvg').innerText = totalCount > 0 ? `$ ${(budget / totalCount).toFixed(3)}` : '$ 0';
    });

    function toggleDetails() {
        const d = document.getElementById('details');
        d.style.display = d.style.display === 'block' ? 'none' : 'block';
    }
</script>

</body>
</html>
